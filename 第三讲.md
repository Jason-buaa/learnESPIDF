在上一课介绍了如何完整的搭建 ESP-IDF 开发环境以及所需要的工具，现在大家可以方便地进行代码查看和编译了。但如果想要做得更好，还有一些东西我们需要优化一下。第一个就是环境变量。那么现在大家打开虚拟机，我这边已经打开了。好打开我们的终端工具模板，Extent，直接双击登录。好现在我们打回到这个 hello world 工程里面去。那么直接输入 IDF，点 py build，那么这里系统会提示找不到这个命令。那么比较奇怪，我们上节课明明已经设置了这个环境变量了，这节课怎么又不行了。原来上节课我们设置的那个环境变量只是一个临时的，现在我们重新登录这个终端之后，我们又要重新设置一下这个环境变量，那么每次都需要如此，有没有什么方法可以快速的解决这个问题，一劳永逸呢？那答案也是有的。

首先我们回到我们的一个默认终端，默认登录路径，查看当前有这么一个点 profile 隐藏文件。这个点 profile 隐藏文件就是我们终端登录之后会默认执行里面的一个语句。我们可以在这个文件里面加入设置环境变量的那个语句，那么就可以了。我们这边直接用 vi 编辑这个 profile 文件，直接在最后一行插入，插入这个语句是执行 esp-idf 下面这个 export 脚本会执行这个脚本之后，会自动的把这个环境变量添加到我们当前的系统路径中好。现在我们试一下退出，按 R 再重新登录，大家看到他会自动的执行了这个里面的一个脚本语句。现在我们试一下，看编译是否成功。好现在编译就没有什么问题了。

那么第二个要优化的地方是我们的 VS Code，我们打开 VS Code，好找到我们这个插件管理，选择这个 SSH 上已安装的，然后找到个 C++，我们点击小齿轮，找到扩展设置。那么这边我们搜按一个空格键，然后搜索 workspace，找到这个百分百 CPU 这里，那么这里默认值是一个最高的百分百占用。那么什么意思呢？这里就是当这个 C++ 插件运行的时候，他有可能是占用了全部 CPU，那么这里我们当然不希望他们这么做，我们直接设置到一个中等程度，也就是这个插件运行最高峰只会占用 50%。

好第三个需要优化的地方，我们先关掉这个，第三个需要优化的地方是我们的 USB。现在我们把开发板插到电脑上，这里点击连接到虚拟机，好现在我们点烧入 IDF，点 py fresh，那么这里大家上节课如果有印象的话，这里会提示一个权限不足，就是个设备文件权限不足。那么这里我已经解决了这个问题，那么到底是怎么解决的呢？因为这个问题比较烦人，每次我们重新插开发版，或者说重启虚拟机之后，再点这个 DF，点 py fresh，它就会又弹出这个问题。那么这里有个易遥一劳永逸的解决方法，就是输入下命令，那么这个命令最后这里要改成大家各自的用户名。那么这个命令额输入之后，这个错误大家不用管，这错误我这边不知道为什么弹了这个错误，正常情况下是没有这个错误的。好现在大家执行这个 F 点 py flash 这个语句，那么这里会又会弹一个新错误出来，那么这个错误不是权限问题，它这里也会提示你这个设备文件当前正在忙或者不存在，那么这就奇怪了，明明我们已经呃没有再使用了，那么这个错误也也是经常会出现。那么这里有什么解决方法呢？那么这里回到我们的虚拟机，点击右键设置，这是看到 USB 控制器选择 USB 3.1 点确认，这里会重新设置，设置之后我们点这里重新连接好，现在我们再次 solo，这个错误就不存在了。

我们使用这个 monitor 工具看一下，好，现在我们就不存在说刚才那个串口设备文件在忙的这个问题了。那么接下来还有一个要优化的地方，还是回到 VS Code，我这边把远程连接关掉，重新来登录一遍，选择右键在当前窗口中连接，那么这里会提示你输入一次密码，那我们打开相应的工程目录，也就是我们的 hello world，点确定，这里又会提示你输入一次密码，那有没有什么好方法，不用我们每次都输密码，我们直接就点开就直接登录了，不用输密码方便。那么其实这个 SSH 登录它是一个加密登录的方式，我们输密码只是一种方式，当然我们可以也可以用证书的方式，用证书的方式的话就会自动验证，就不需要我们输密码了。

那么首先我们要在这个 U 盘图上加入 windows 上的一个公钥，那么具体怎么操作呢？首先我们打开这个 windows 下的 power，生成一个证书文件，输入三命令，后面输入一个邮箱地址，这个邮箱的话大家不用太在意，随便输一个就好了，回车大家一路回车，到底不要输任何东西，因为我这边之前已经生成过了，这里叫我覆盖，我这边就不覆盖了，大家一一路回车就好了。好了，那么这个公告这个证书文件在哪里呢？在 C 盘用户大家找到各自登录 windows 上的用户名文件夹，然后找到 SSH 这个文件夹，那么这两个文件就是刚才那串指令生成的，一两个密钥文件，一个是私钥，一个是公钥，我们用到的就是这个公钥，我们打开里面把里面的内容复制一下，复制一下，然后回到我们的 MOBIEXTEN，回到默认的登录路径查看，这里有一个点 SSH 这个隐藏文件夹，那么我们我们回到我们进入到这个文件夹里面，看下有什么东内容，那么里面只有一个文件，这个就是验我们要用到这个文件，我们直接编辑，我们这个默认情况下这个文件里面是空的，我们把刚才那一串额公告文件加到里面去，就是这么串，Paste h，那么如果大家不想在 VNVM 下操作，也可以也可以用 VS Code 上面操作，那么怎么操作呢？我这边关闭这个文件夹，关闭之后，这里可能会让你输一次密码，我们打开文件夹，然后找到这个 SSH 这个文件夹，点一下，点确定，这里会让可能会叫你输一次密码，那么找到打开这个 ossify kit 这个文件，把刚才那个那个串内容复制进去就好了。好现在我们验证一下到底要不要再输密码啊，先关掉远程，关掉远程连接好，重新来一遍，好我们打开远程连接，在当前窗口中连接，好现在在现在他就不需要我们输入密码了，我们打开文件夹，打开我们的 hello world，也不需要我们输密码了，我们就解决了这个问题。

那么接下来给大家介绍一下这个工程目录里面到底有哪些内容，第一个是 vs code，Vscode 就是这个文这个文件夹，就是 vs code 这个工具生成的一个文件夹，跟工程额没有关系，没有什么关系，他只是为了方便我们查看代码，而生成的一些中间中间 JSON 文件。那第二个就是 build 文件夹，build 这个文件夹本来是不存在的，只有我们执行了 IDF 点 py build 这个命令之后，它会生成一些中间编译过程文件，包括我们最终的要烧录 bin 文件。第一个三个是 main 文件夹，main 文件夹这个是必须存在的，不然的话我们是编译不通过的，main 文件夹里面就是主要存放我们的工程源文件，以及还有这个 c max，那这个 C 妹 c made list 这个文件有什么用呢？它主要是告诉 c made 这个构建系统该如何去编译我们的工程，那么如果大家以后要有一些需要自己新增的源文件，可以在这里也需要增加一个相应的配置，比如说我新增了一个 test，test 文件夹文件源文件，当然也可以新增一些包含路路径，那么 may 点 C 这个文源文件，就是我们的应用入口函数，应用入口文件了，它里面 app 点 main 这个函数是我们的入口函数，准确来说应该是我们程序应用的入口入口函数，那么大家看到顶层也还有一个 CMCMALIX 这个文件，那么这个 CMIS 就是告诉我们整个呃 c may 编译系统该如何去编译我们整个工程的一个文件，那么大家看到里面最主要还是第一句，他把 ESPITF 路径下这个 project 点 c made 里面内容包放在这里了，那么具体是什么内容，里面是比较复杂的，就那么我们这边也不去展开说了，那么第二句就是我们可以给自己的工程起个名字，那么里面内容是可以改的，比如说改成 made 等等，那么这里会关乎到我们最终生成 B 文件，那个 bin 文件的名字，那么这有个 SDK configure，这个是我们工程的配置文件，那么这个配置文件是我们使用 DF 点 py mu configure 生成的这个文件，等下我给大家说，那么先看一下我们 build 之后生成的 bin 文件在什么地方，我们直接看这个呃 JSON 文件主要看这里，大家看到我们这个工程生成了三个 bin 文件，第一个是 BLOAD，就是我们应用前应用启动前的一段程序，第二个就是我们真正的应用程序了，而这个是分区文件，告诉我们那每一个分区分别存放了什么，那么这个分区的概念在后续的教程中会继续介绍。

那么大家如果是有新的项目，建议是直接从现有的工程中直接拷贝一份出来，直接开发，这样子效率比较高。好了，接下来要给大家介绍一个额工程是如何配置的，那么怎么因为我们的昨天下载 ESPIDF 这个 SDK 的时候，我们花的时间是比较长的，说明这个 SDK 是十分庞大的，但其实里面有很多功能不是我们项目中要用到的，或者说一些参数我们只是需要细调，因此我们需要对我们的工程项目进行一个配置，那么怎么配置呢？我建议在这个终端工具里面进行配置，那么我们输入回到 hello world 程序，执行 IDF 等于 py manu configure，它这里就会弹出一个配置界面，跟 LINUX 下的 make 面 configure 有点像，那么这里可配置内容实在太多了，我们一时我这边一时半会也接受不完，那么而且大部分的配置我们是可以用默认值的，那么在以后的学习过程中，我们用到哪个就去配哪个就好了，那么现在我们先修改这么几个值，我先把它改回来，先，哦不用谢，我们先改这么几个值吧，第一个是工作主频，那么默认的这个 menu configure 它默认是 160 兆赫兹，但是我们 esp32 最高是支持 240 兆赫兹的，第二个是 fresh 大小，fresh 大小的话默认是两兆，但我们开发版的是上的模组设置是四兆 fresh，PS ram 默认是没有，但我们开发板上的模组支持两兆 pram，那么怎么改呢？首先我们改这个主屏，找到 component configure，然后 e s p system setting，这里这里默认原先是 160 兆赫兹，现在我改我们这边改成 240 兆赫兹，好第二个要改的是 fresh 大小，回到顶层，找到 fresh configure，这里改成四兆左键返回，那么最后一个是 PRN 设置在 component configure，E s p p s rap，这里原先是不选的，现在我们把它选上好了，选全部配置完毕，按 S 回车再回车，按 Q 退出，现在我每次我们修改了这个 SDK configure 之后，他就会重新编译整个一些 esp idf 以及我们的工程，那么虽然说呃重新编译，但是在 WU 半图下编译速度还是比较快的，如果这个过程在 windows 下执行，那么 windows 下编译可能要十几 20 分钟，好编译完成，我们直接收入，我们直接运行这个模拟可控制，发现没什么变化，因为我们这个程序 hello world 太简单了，看不出什么有什么改进的地方，但我们可以看到前期有一些打印，比如说我们的 CPU 改成 240 兆赫兹了啊，还有一找到两兆的 p rain，大家看到没有，好了，退出这个 monitor 工具，是大家不要忘记是 CTRL 加右方括号好了，那么今天的课程也就差不多了，谢谢大家的收听。
